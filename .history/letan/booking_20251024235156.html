<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lễ Tân - Đặt Phòng</title>
    <link rel="stylesheet" href="css/booking.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Litepicker styles (required for date range calendar) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-hotel"></i>
            <h2>Lễ Tân</h2>
        </div>
        <nav class="nav-menu">
            <a href="letan_dashboard.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>Tổng Quan</span>
            </a>
            <a href="checkin.html" class="nav-item">
                <i class="fas fa-calendar-check"></i>
                <span>Check-in</span>
            </a>
            <a href="checkout.html" class="nav-item">
                <i class="fas fa-door-open"></i>
                <span>Check-out</span>
            </a>
            <a href="services.html" class="nav-item">
                <i class="fas fa-concierge-bell"></i>
                <span>Dịch Vụ</span>
            </a>
            <a href="rooms_management.html" class="nav-item">
                <i class="fas fa-bed"></i>
                <span>Quản Lý Phòng</span>
            </a>
            <a href="booking.html" class="nav-item active">
                <i class="fas fa-calendar-alt"></i>
                <span>Đặt Phòng</span>
            </a>
            <a href="room_change.html" class="nav-item">
                <i class="fas fa-exchange-alt"></i>
                <span>Đổi Phòng</span>
            </a>
            <a href="customers.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span>Khách Hàng</span>
            </a>
            <a href="booking_list.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span>Danh Sách Đặt Phòng</span>
            </a>

        </nav>
        <div class="sidebar-footer">
            <a href="#" class="nav-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng Xuất</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Đặt Phòng</h1>
            </div>
            <div class="header-right">
                <div class="user-profile">
                    <i class="fas fa-user-circle"></i>
                    <span id="userName">Nhân Viên</span>
                </div>
            </div>
        </header>

        <!-- Booking Content -->
        <div class="booking-content">
            <!-- Search Section -->
            <div class="card search-section">
                <h3><i class="fas fa-search"></i> Tìm Phòng Trống</h3>
                <div class="search-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="date-range-picker">Ngày Nhận - Trả Phòng</label>
                            <!-- Visible date range picker (Litepicker) similar to customer UI -->
                            <input type="text" id="date-range-picker" placeholder="Chọn khoảng ngày" required>
                            <!-- Hidden individual date inputs kept for compatibility with existing JS -->
                            <input type="date" id="checkInDate" style="display:none;">
                        </div>
                        <div class="form-group">
                            <label for="checkOutDate" style="display:none;">Ngày Trả Phòng</label>
                            <input type="date" id="checkOutDate" style="display:none;">
                        </div>
                        <div class="form-group">
                            <label for="guestCount">Số Người</label>
                            <select id="guestCount">
                                <option value="1" selected>1 người</option>
                                <option value="2">2 người</option>
                                <option value="3">3 người</option>
                                <option value="4">4 người</option>
                                <option value="5">5 người</option>
                                <option value="6">6 người</option>
                                <option value="7">7 người</option>
                                <option value="8">8 người</option>
                                <option value="9">9 người</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="roomType">Loại Phòng</label>
                            <select id="roomType">
                                <option value="">Tất cả loại phòng</option>
                                <option value="standard"></option>
                                <option value="deluxe"></option>
                                <option value="suite"></option>
                                <option value="vip"></option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="button" id="searchRoomsBtn" class="btn btn-primary">
                                <i class="fas fa-search"></i> Tìm Phòng
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Available Rooms Section -->
            <div class="card rooms-section" id="roomsSection" style="display: none;">
                <h3><i class="fas fa-bed"></i> Phòng Trống</h3>
                <div class="rooms-grid" id="roomsGrid">
                    <!-- Available rooms will be loaded here -->
                </div>
            </div>

            <!-- Booking Form Section -->
            <div class="card booking-form-section" id="bookingFormSection" style="display: none;">
                <h3><i class="fas fa-edit"></i> Thông Tin Đặt Phòng</h3>
                <form id="bookingForm">
                    <div class="form-sections">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h4><i class="fas fa-user"></i> Thông Tin Khách Hàng</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="customerName">Họ Tên <span class="required">*</span></label>
                                    <input type="text" id="customerName" required>
                                </div>
                                <div class="form-group">
                                    <label for="customerPhone">Số Điện Thoại <span class="required">*</span></label>
                                    <input type="tel" id="customerPhone" required>
                                </div>
                                <div class="form-group">
                                    <label for="customerEmail">Email</label>
                                    <input type="email" id="customerEmail">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="customerIdCard">CCCD/CMND <span class="required">*</span></label>
                                    <input type="text" id="customerIdCard" required>
                                </div>
                                <div class="form-group">
                                    <label for="customerAddress">Địa Chỉ</label>
                                    <input type="text" id="customerAddress">
                                </div>
                            </div>
                        </div>

                        <!-- Room Selection Summary -->
                        <div class="form-section">
                            <h4><i class="fas fa-bed"></i> Phòng Đã Chọn</h4>
                            <div id="selectedRoomInfo" class="selected-room-info">
                                <!-- Selected room info will appear here -->
                            </div>
                        </div>

                        <!-- Booking Details -->
                        <div class="form-section">
                            <div class="form-row" style="display: flex; gap: 20px; align-items: flex-start;">
                                <div class="form-group" style="flex: 1;">
                                    <label for="bookingType">Loại Đặt Phòng</label>
                                    <select id="bookingType" onchange="handleBookingTypeChange()" style="width: 100%;">
                                        <option value="advance">Đặt</option>
                                    </select>
                                </div>

                                <div class="form-group" style="flex: 2;">
                                    <label for="specialRequests">Yêu Cầu Đặc Biệt</label>
                                    <textarea id="specialRequests" rows="4" placeholder="Ghi chú về yêu cầu đặc biệt của khách hàng..." style="width: 100%;"></textarea>
                                </div>
                            </div>
                        </div>


                        <!-- Price Summary -->
                        <div class="form-section price-summary">
                            <h4><i class="fas fa-calculator"></i> Tổng Kết Giá</h4>
                            <div class="price-details">
                                <div class="price-row">
                                    <span>Giá phòng/đêm:</span>
                                    <span id="roomPricePerNight">0 ₫</span>
                                </div>
                                <div class="price-row">
                                    <span>Số đêm:</span>
                                    <span id="totalNights">0</span>
                                </div>
                                <div class="price-row">
                                    <span>Tạm tính:</span>
                                    <span id="subtotal">0 ₫</span>
                                </div>
                                <!-- Tax removed per request -->
                                <div class="price-row total">
                                    <span><strong>Tổng tiền:</strong></span>
                                    <span id="totalAmount"><strong>0 ₫</strong></span>
                                </div>
                                <!-- Deposit/remaining removed: payment will be handled at checkout/check-in -->
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="button" id="cancelBookingBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Hủy Bỏ
                            </button>
                            <button type="submit" id="confirmBookingBtn" class="btn btn-primary">
                                <i class="fas fa-check"></i> <span id="confirmButtonText">Xác Nhận Đặt Phòng</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Booking Success Modal -->
    <div class="modal" id="bookingSuccessModal">
        <div class="modal-content">
            <div class="modal-header success">
                <h3><i class="fas fa-check-circle"></i> Đặt Phòng Thành Công!</h3>
            </div>
            <div class="modal-body">
                <div class="success-info">
                    <p><strong>Mã đặt phòng:</strong> <span id="bookingCode"></span></p>
                    <p><strong>Khách hàng:</strong> <span id="successCustomerName"></span></p>
                    <p><strong>Phòng:</strong> <span id="successRoomNumber"></span></p>
                    <p><strong>Thời gian:</strong> <span id="successDates"></span></p>
                    <p><strong>Tổng tiền:</strong> <span id="successTotalAmount"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSuccessModal()">
                    <i class="fas fa-times"></i> Đóng
                </button>
                <button class="btn btn-primary" onclick="printBookingInfo()">
                    <i class="fas fa-print"></i> In Phiếu
                </button>
            </div>
        </div>
    </div>
    <!-- MẪU IN PDF: PHIẾU ĐẶT PHÒNG -->
    <div id="printBookingTemplate" style="display:none; width: 800px; font-family: 'Times New Roman', serif; color:#000;">
        <!-- Header -->
        <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:20px;">
            <img src="../assets/img/logo.jpg" alt="Hotel Logo" style="height:90px; display:block; margin:auto;">
            <h2 style="margin:5px 0 0 0;">KHÁCH SẠN THANH TRÀ</h2>
            <p style="margin:0;">Địa chỉ: 123 Nguyễn Huệ, TP.HCM | Điện thoại: (028) 1234 5678</p>
        </div>

        <h3 style="text-align:center; margin-bottom:10px;">PHIẾU XÁC NHẬN ĐẶT PHÒNG</h3>

        <!-- Thông tin booking -->
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <tr>
                <td><strong>Mã Booking:</strong> <span id="p_maDatPhong"></span></td>
                <td><strong>Ngày Đặt:</strong> <span id="p_ngayDat"></span></td>
            </tr>
            <tr>
                <td><strong>Trạng Thái:</strong> <span id="p_trangThai"></span></td>
                <td><strong>Thanh Toán:</strong> <span id="p_trangThaiTT"></span></td>
            </tr>
        </table>

        <!-- Thông tin khách hàng -->
        <h4 style="margin-bottom:5px;">I. THÔNG TIN KHÁCH HÀNG</h4>
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <tr>
                <td><strong>Họ tên:</strong> <span id="p_khachHang"></span></td>
            </tr>
            <tr>
                <td><strong>Số điện thoại:</strong> <span id="p_sdt"></span></td>
            </tr>
            <tr>
                <td><strong>Email:</strong> <span id="p_email"></span></td>
            </tr>
            <tr>
                <td><strong>CCCD/CMND:</strong> <span id="p_cccd"></span></td>
            </tr>
        </table>

        <!-- Thông tin phòng -->
        <h4 style="margin-bottom:5px;">II. THÔNG TIN PHÒNG</h4>
        <table border="1" cellpadding="8" style="width:100%; border-collapse:collapse; text-align:center; margin-bottom:20px;">
            <thead style="background-color:#f3f3f3;">
                <tr>
                    <th>Số Phòng</th>
                    <th>Loại Phòng</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="p_phong"></td>
                    <td id="p_loaiPhong"></td>
                    <td id="p_checkin"></td>
                    <td id="p_checkout"></td>
                </tr>
            </tbody>
        </table>

        <!-- Chi tiết thanh toán -->
        <h4 style="margin-bottom:5px;">III. CHI TIẾT THANH TOÁN</h4>
        <table border="1" cellpadding="8" style="width:100%; border-collapse:collapse; text-align:left;">
            <tr>
                <td><strong>Tiền phòng:</strong></td>
                <td id="p_tienPhong" style="text-align:right;"></td>
            </tr>
            <tr>
                <td><strong>Tiền dịch vụ:</strong></td>
                <td id="p_tienDichVu" style="text-align:right;"></td>
            </tr>
            <tr style="background:#f8f8f8; font-weight:bold;">
                <td>TỔNG CỘNG</td>
                <td id="p_tongTien" style="text-align:right;"></td>
            </tr>
        </table>

        <p style="margin-top:20px;"><strong>Ghi chú:</strong> <span id="p_ghiChu"></span></p>

        <!-- Chữ ký -->
        <div style="margin-top:50px; display:flex; justify-content:space-between; text-align:center;">
            <div>
                <strong>Khách hàng</strong><br><br><br>
                <span id="p_tenKhachHangKy">______________________</span>
            </div>
            <div>
                <strong>Lễ tân</strong><br><br><br>
                <span id="p_tenLeTanKy">______________________</span>
            </div>
        </div>

        <p style="text-align:right; margin-top:30px; font-style:italic;">
            Ngày in: <span id="p_ngayIn"></span>
        </p>
    </div>

    <!-- Litepicker library - must be loaded before booking.js so the picker can initialize -->
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    <script src="api/booking.api.js"></script>
    <script src="js/booking.ui.js"></script>
    <script src="api/navigation-preloader.js"></script>
</body>

</html>