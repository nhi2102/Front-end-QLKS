<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh Sách Đặt Phòng - Lễ Tân</title>
    <link rel="stylesheet" href="css/letan_dashboard.css">
    <link rel="stylesheet" href="css/booking_list.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-hotel"></i>
            <h2>Lễ Tân</h2>
        </div>
        <nav class="nav-menu">
            <a href="letan_dashboard.html" class="nav-item">
                <i class="fas fa-chart-line"></i>
                <span>Tổng Quan</span>
            </a>
            <a href="checkin.html" class="nav-item">
                <i class="fas fa-calendar-check"></i>
                <span>Check-in</span>
            </a>
            <a href="checkout.html" class="nav-item">
                <i class="fas fa-door-open"></i>
                <span>Check-out</span>
            </a>
            <a href="services.html" class="nav-item">
                <i class="fas fa-concierge-bell"></i>
                <span>Dịch Vụ</span>
            </a>
            <a href="rooms_management.html" class="nav-item">
                <i class="fas fa-bed"></i>
                <span>Quản Lý Phòng</span>
            </a>
            <a href="booking.html" class="nav-item">
                <i class="fas fa-calendar-alt"></i>
                <span>Đặt Phòng</span>
            </a>
            <a href="room_change.html" class="nav-item">
                <i class="fas fa-exchange-alt"></i>
                <span>Đổi Phòng</span>
            </a>
            <a href="customers.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span>Khách Hàng</span>
            </a>
            <a href="booking_list.html" class="nav-item active">
                <i class="fas fa-list-alt"></i>
                <span>Danh Sách Đặt Phòng</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="../login.html" class="nav-item logout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng Xuất</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Danh Sách Đặt Phòng</h1>
            </div>
            <div class="header-right">
                <div class="user-profile" id="userProfileBtn" style="cursor: pointer;">
                    <i class="fas fa-user-circle"></i>
                    <span id="userName">Lễ Tân</span>
                </div>
            </div>
        </header>


        <!-- Filter Section -->
        <section class="filter-section">
            <div class="filter-card">
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterBookings('Tất cả')" data-filter="Tất cả">
                            <i class="fas fa-list"></i> Tất Cả
                        </button>
                    <button class="filter-tab" onclick="filterBookings('Đang ở')" data-filter="Đang ở">
                            <i class="fas fa-bed"></i> Đang Ở
                        </button>
                    <button class="filter-tab" onclick="filterBookings('checkin hôm nay')" data-filter="checkin hôm nay">
                            <i class="fas fa-sign-in-alt"></i> Check-in Hôm Nay
                        </button>
                    <button class="filter-tab" onclick="filterBookings('checkout hôm nay')" data-filter="checkout hôm nay">
                            <i class="fas fa-sign-out-alt"></i> Check-out Hôm Nay
                        </button>
                    <button class="filter-tab" onclick="filterBookings('Đã đặt')" data-filter="Đã đặt">
                            <i class="fas fa-clock"></i> Đã Đặt
                        </button>
                    <button class="filter-tab" onclick="filterBookings('Đã trả')" data-filter="Đã trả">
                            <i class="fas fa-check-circle"></i> Đã Trả
                        </button>
                    <button class="filter-tab" onclick="filterBookings('Đã hủy')" data-filter="Đã hủy">
                            <i class="fas fa-times-circle"></i> Đã Hủy
                        </button>
                </div>

                <div class="search-bar">
                    <div class="search-input-group">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Tìm kiếm theo mã booking, tên khách, số phòng, số điện thoại...">
                    </div>
                    <button class="btn-refresh" onclick="refreshBookings()">
                            <i class="fas fa-sync-alt"></i> Làm Mới
                        </button>
                </div>
            </div>
        </section>

        <!-- Bookings List Section -->
        <section class="bookings-section">
            <div class="bookings-card">
                <div class="bookings-header">
                    <h2>
                        <i class="fas fa-list-alt"></i>
                        <span id="currentFilterTitle">Tất Cả Đặt Phòng</span>
                        <span class="booking-count" id="bookingCount">(0)</span>
                    </h2>
                </div>

                <div class="bookings-table-container">
                    <table class="bookings-table">
                        <thead>
                            <tr>
                                <th>Mã Booking</th>
                                <th>Khách Hàng</th>
                                <th>Số Điện Thoại</th>
                                <th>Phòng</th>
                                <th>Loại Phòng</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Trạng thái thanh toán</th>
                                <th>Tổng Tiền</th>
                                <th>Trạng Thái</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsTableBody">
                            <tr>
                                <td colspan="11" class="loading">
                                    <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination">
                    <button class="page-btn" onclick="previousPage()" id="prevBtn">
                            <i class="fas fa-chevron-left"></i> Trước
                        </button>
                    <div class="page-numbers" id="pageNumbers"></div>
                    <button class="page-btn" onclick="nextPage()" id="nextBtn">
                            Sau <i class="fas fa-chevron-right"></i>
                        </button>
                </div>
            </div>
        </section>
    </div>
    </div>

    <!-- Booking Detail Modal -->
    <div id="bookingDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> Chi Tiết Đặt Phòng</h2>
                <button class="modal-close" onclick="closeBookingDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <!-- Booking Information -->
                <div class="info-section">
                    <h3><i class="fas fa-file-alt"></i> Thông Tin Đặt Phòng</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Mã Booking:</label>
                            <span id="modalBookingCode" class="highlight-text">-</span>
                        </div>
                        <div class="info-item">
                            <label>Ngày Đặt:</label>
                            <span id="modalBookingDate">-</span>
                        </div>
                        <div class="info-item">
                            <label>Trạng Thái:</label>
                            <span id="modalStatus">-</span>
                        </div>
                    </div>
                </div>

                <!-- Customer Information -->
                <div class="info-section">
                    <h3><i class="fas fa-user"></i> Thông Tin Khách Hàng</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Họ Tên:</label>
                            <span id="modalCustomerName">-</span>
                        </div>
                        <div class="info-item">
                            <label>Số Điện Thoại:</label>
                            <span id="modalCustomerPhone">-</span>
                        </div>
                        <div class="info-item">
                            <label>Email:</label>
                            <span id="modalCustomerEmail">-</span>
                        </div>
                        <div class="info-item">
                            <label>CCCD/CMND:</label>
                            <span id="modalCustomerID">-</span>
                        </div>
                    </div>
                </div>

                <!-- Room Information -->
                <div class="info-section">
                    <h3><i class="fas fa-bed"></i> Thông Tin Phòng</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Số Phòng:</label>
                            <span id="modalRoomNumber" class="highlight-text">-</span>
                        </div>
                        <div class="info-item">
                            <label>Loại Phòng:</label>
                            <span id="modalRoomType">-</span>
                        </div>
                        <div class="info-item">
                            <label>Check-in:</label>
                            <span id="modalCheckin">-</span>
                        </div>
                        <div class="info-item">
                            <label>Check-out:</label>
                            <span id="modalCheckout">-</span>
                        </div>
                    </div>
                </div>

                <!-- Payment Information -->
                <div class="info-section">
                    <h3><i class="fas fa-money-bill-wave"></i> Thông Tin Thanh Toán</h3>
                    <div class="payment-details">
                        <div class="payment-row">
                            <label>Tổng Tiền Phòng:</label>
                            <span id="modalRoomPrice">-</span>
                        </div>
                        <div class="payment-row">
                            <label>Dịch Vụ:</label>
                            <span id="modalServiceFee">-</span>
                        </div>
                        <div class="payment-row" id="discountPointRow" style="display: none;">
                            <label>Giảm Giá Bằng Điểm:</label>
                            <span id="modalDiscountPoint" style="color: #16a34a;">-</span>
                        </div>
                        <div class="payment-row total">
                            <label>Tổng Cộng:</label>
                            <span id="modalGrandTotal">-</span>
                        </div>
                        <div class="payment-row">
                            <label>Đã Thanh Toán:</label>
                            <span id="modalPaid">-</span>
                        </div>
                        <div class="payment-row">
                            <label>Còn Lại:</label>
                            <span id="modalRemaining">-</span>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="info-section">
                    <h3><i class="fas fa-sticky-note"></i> Ghi Chú</h3>
                    <p id="modalNotes" class="notes-text">-</p>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeBookingDetailModal()">
                    <i class="fas fa-times"></i> Đóng
                </button>
                <button type="button" class="btn btn-primary" onclick="printBooking()" id="btnPrint">
                    <i class="fas fa-print"></i> In
                </button>
                <button type="button" class="btn btn-danger" onclick="confirmCancelBooking()" id="btnCancel">
                    <i class="fas fa-ban"></i> Hủy Booking
                </button>
            </div>
        </div>
    </div>
    <!-- MẪU IN PDF: PHIẾU ĐẶT PHÒNG -->
    <div id="printBookingTemplate" style="display:none; width: 800px; font-family: 'Times New Roman', serif; color:#000;">
        <!-- Header -->
        <div style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:20px;">
            <img src="../assets/img/logo.jpg" alt="Hotel Logo" style="height:90px; display:block; margin:auto;">
            <h2 style="margin:5px 0 0 0;">KHÁCH SẠN THANH TRÀ</h2>
        </div>

        <h3 style="text-align:center; margin-bottom:10px;">PHIẾU XÁC NHẬN ĐẶT PHÒNG</h3>

        <!-- Thông tin booking -->
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <tr>
                <td><strong>Mã Booking:</strong> <span id="p_maDatPhong"></span></td>
                <td><strong>Ngày Đặt:</strong> <span id="p_ngayDat"></span></td>
            </tr>
            <tr>
                <td><strong>Trạng Thái:</strong> <span id="p_trangThai"></span></td>
                <td><strong>Thanh Toán:</strong> <span id="p_trangThaiTT"></span></td>
            </tr>
        </table>

        <!-- Thông tin khách hàng -->
        <h4 style="margin-bottom:5px;">I. THÔNG TIN KHÁCH HÀNG</h4>
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <tr>
                <td><strong>Họ tên:</strong> <span id="p_khachHang"></span></td>
            </tr>
            <tr>
                <td><strong>Số điện thoại:</strong> <span id="p_sdt"></span></td>
            </tr>
            <tr>
                <td><strong>Email:</strong> <span id="p_email"></span></td>
            </tr>
            <tr>
                <td><strong>CCCD/CMND:</strong> <span id="p_cccd"></span></td>
            </tr>
        </table>

        <!-- Thông tin phòng -->
        <h4 style="margin-bottom:5px;">II. THÔNG TIN PHÒNG</h4>
        <table border="1" cellpadding="8" style="width:100%; border-collapse:collapse; text-align:center; margin-bottom:20px;">
            <thead style="background-color:#f3f3f3;">
                <tr>
                    <th>Số Phòng</th>
                    <th>Loại Phòng</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="p_phong"></td>
                    <td id="p_loaiPhong"></td>
                    <td id="p_checkin"></td>
                    <td id="p_checkout"></td>
                </tr>
            </tbody>
        </table>

        <!-- Chi tiết thanh toán -->
        <h4 style="margin-bottom:5px;">III. CHI TIẾT THANH TOÁN</h4>
        <table border="1" cellpadding="8" style="width:100%; border-collapse:collapse; text-align:left;">
            <tr>
                <td><strong>Tiền phòng:</strong></td>
                <td id="p_tienPhong" style="text-align:right;"></td>
            </tr>
            <tr>
                <td><strong>Tiền dịch vụ:</strong></td>
                <td id="p_tienDichVu" style="text-align:right;"></td>
            </tr>
            <tr id="p_discountRow" style="display:none; color:#16a34a;">
                <td><strong>Giảm giá bằng điểm:</strong></td>
                <td id="p_giamGiaDiem" style="text-align:right;"></td>
            </tr>
            <tr style="background:#f8f8f8; font-weight:bold;">
                <td>TỔNG CỘNG</td>
                <td id="p_tongTien" style="text-align:right;"></td>
            </tr>
        </table>

        <p style="margin-top:20px;"><strong>Ghi chú:</strong> <span id="p_ghiChu"></span></p>

        <!-- Chữ ký -->
        <div style="margin-top:50px; display:flex; justify-content:space-between; text-align:center;">
            <div>
                <strong>Khách hàng</strong><br><br><br>
                <span id="p_tenKhachHangKy">______________________</span>
            </div>
            <div>
                <strong>Lễ tân</strong><br><br><br>
                <span id="p_tenLeTanKy">______________________</span>
            </div>
        </div>

        <p style="text-align:right; margin-top:30px; font-style:italic;">
            Ngày in: <span id="p_ngayIn"></span>
        </p>
    </div>

    <!-- Modal Thông Tin Cá Nhân -->
    <div id="profileModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-user-circle"></i> Thông Tin Cá Nhân</h2>
                <button class="modal-close" onclick="closeProfileModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div class="info-section">
                    <h3 style="margin-bottom: 15px;"><i class="fas fa-user"></i> Thông Tin Cá Nhân</h3>
                    <div class="profile-info-container">
                        <div class="profile-info-row">
                            <div class="profile-info-item">
                                <label><i class="fas fa-id-badge"></i> Họ tên:</label>
                                <span id="profile_name">-</span>
                            </div>
                            <div class="profile-info-item">
                                <label><i class="fas fa-envelope"></i> Email:</label>
                                <span id="profile_email">-</span>
                            </div>
                        </div>
                        <div class="profile-info-row">
                            <div class="profile-info-item">
                                <label><i class="fas fa-phone"></i> Số điện thoại:</label>
                                <span id="profile_phone">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3><i class="fas fa-key"></i> Đổi Mật Khẩu</h3>
                    <form id="changePasswordForm" onsubmit="handleChangePassword(event)">
                        <input type="hidden" id="emailorsdt_input">
                        <div class="form-group">
                            <label>Mật khẩu hiện tại:</label>
                            <input type="password" id="current_password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Mật khẩu mới:</label>
                            <input type="password" id="new_password" class="form-control" required minlength="8">
                            <small class="form-text">Tối thiểu 8 ký tự, bắt đầu bằng chữ hoa, có chữ thường, số và ký tự đặc biệt</small>
                        </div>
                        <div class="form-group">
                            <label>Xác nhận mật khẩu mới:</label>
                            <input type="password" id="confirm_password" class="form-control" required minlength="8">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                            <i class="fas fa-check"></i> Đổi Mật Khẩu
                        </button>
                    </form>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeProfileModal()">
                    <i class="fas fa-times"></i> Đóng
                </button>
            </div>
        </div>
    </div>



    <script src="api/booking_list.api.js"></script>
    <script src="js/booking_list.ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</body>

</html>

</html>