<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả thanh toán - Thanh Trà Hotel</title>
    <link rel="stylesheet" href="../khachhang/css/style.css">
    <link rel="stylesheet" href="../khachhang/css/header.css">
    <link rel="stylesheet" href="../khachhang/css/footer.css">
    <style>
        .payment-result-container {
            max-width: 600px;
            margin: 100px auto;
            padding: 40px;
            text-align: center;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .result-icon.success {
            color: #28a745;
        }
        
        .result-icon.error {
            color: #dc3545;
        }
        
        .result-title {
            font-size: 28px;
            margin-bottom: 15px;
            color: #112173;
        }
        
        .result-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .result-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 600;
            color: #333;
        }
        
        .detail-value {
            color: #666;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #112173;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0d1a5c;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
    </style>
</head>

<body>
    <div id="header-placeholder"></div>

    <div class="payment-result-container">
        <div id="result-content">
            <div class="result-icon"></div>
            <h1 class="result-title">Đang xử lý kết quả thanh toán...</h1>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script src="../khachhang/js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const vnp_ResponseCode = urlParams.get('vnp_ResponseCode');
            const vnp_TxnRef = urlParams.get('vnp_TxnRef');
            const vnp_OrderInfo = urlParams.get('vnp_OrderInfo');
            const vnp_Amount = urlParams.get('vnp_Amount');
            const vnp_TransactionNo = urlParams.get('vnp_TransactionNo');
            const vnp_PayDate = urlParams.get('vnp_PayDate');

            const resultContent = document.getElementById('result-content');

            if (vnp_ResponseCode === '00') {
                // Thanh toán thành công
                const amount = vnp_Amount ? (parseInt(vnp_Amount) / 100).toLocaleString('vi-VN') : '0';
                const payDate = vnp_PayDate ? formatPaymentDate(vnp_PayDate) : 'N/A';

                resultContent.innerHTML = `
                    <div class="result-icon success">✓</div>
                    <h1 class="result-title">Thanh toán thành công!</h1>
                    <p class="result-message">
                        Cảm ơn bạn đã thanh toán. Đơn đặt phòng của bạn đã được xác nhận.<br>
                        Chúng tôi đã gửi email xác nhận đến hòm thư của bạn.
                    </p>
                    
                    <div class="result-details">
                        <div class="detail-row">
                            <span class="detail-label">Mã giao dịch:</span>
                            <span class="detail-value">${vnp_TransactionNo || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Mã đơn hàng:</span>
                            <span class="detail-value">${vnp_TxnRef || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Số tiền:</span>
                            <span class="detail-value">${amount} VNĐ</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Thời gian:</span>
                            <span class="detail-value">${payDate}</span>
                        </div>
                    </div>

                    <div class="btn-group">
                        <a href="../khachhang/my_room.html" class="btn btn-primary">Xem đơn đặt phòng</a>
                        <a href="../khachhang/home.html" class="btn btn-secondary">Về trang chủ</a>
                    </div>
                `;
            } else {
                // Thanh toán thất bại
                const errorMessage = getErrorMessage(vnp_ResponseCode);

                resultContent.innerHTML = `
                    <div class="result-icon error">✗</div>
                    <h1 class="result-title">Thanh toán thất bại!</h1>
                    <p class="result-message">
                        ${errorMessage}<br>
                        Vui lòng thử lại hoặc liên hệ với chúng tôi để được hỗ trợ.
                    </p>
                    
                    <div class="result-details">
                        <div class="detail-row">
                            <span class="detail-label">Mã lỗi:</span>
                            <span class="detail-value">${vnp_ResponseCode || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Mã đơn hàng:</span>
                            <span class="detail-value">${vnp_TxnRef || 'N/A'}</span>
                        </div>
                    </div>

                    <div class="btn-group">
                        <a href="../khachhang/cus_info_booking.html" class="btn btn-primary">Thử lại</a>
                        <a href="../khachhang/home.html" class="btn btn-secondary">Về trang chủ</a>
                    </div>
                `;
            }
        });

        function formatPaymentDate(dateStr) {
            // Format: yyyyMMddHHmmss -> dd/MM/yyyy HH:mm:ss
            if (!dateStr || dateStr.length !== 14) return dateStr;

            const year = dateStr.substring(0, 4);
            const month = dateStr.substring(4, 6);
            const day = dateStr.substring(6, 8);
            const hour = dateStr.substring(8, 10);
            const minute = dateStr.substring(10, 12);
            const second = dateStr.substring(12, 14);

            return `${day}/${month}/${year} ${hour}:${minute}:${second}`;
        }

        function getErrorMessage(code) {
            const errorMessages = {
                '07': 'Giao dịch bị nghi ngờ gian lận',
                '09': 'Thẻ/Tài khoản của khách hàng chưa đăng ký dịch vụ InternetBanking tại ngân hàng',
                '10': 'Khách hàng xác thực thông tin thẻ/tài khoản không đúng quá 3 lần',
                '11': 'Đã hết hạn chờ thanh toán. Xin quý khách vui lòng thực hiện lại giao dịch',
                '12': 'Thẻ/Tài khoản của khách hàng bị khóa',
                '13': 'Quý khách nhập sai mật khẩu xác thực giao dịch (OTP)',
                '24': 'Khách hàng hủy giao dịch',
                '51': 'Tài khoản của quý khách không đủ số dư để thực hiện giao dịch',
                '65': 'Tài khoản của Quý khách đã vượt quá hạn mức giao dịch trong ngày',
                '75': 'Ngân hàng thanh toán đang bảo trì',
                '79': 'KH nhập sai mật khẩu thanh toán quá số lần quy định',
                '99': 'Lỗi không xác định'
            };

            return errorMessages[code] || 'Đã có lỗi xảy ra trong quá trình thanh toán';
        }
    </script>
</body>

</html>